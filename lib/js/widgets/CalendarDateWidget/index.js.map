{"version":3,"sources":["../../../../src/js/widgets/CalendarDateWidget/index.jsx"],"names":["CalendarDateWidget","options","props","state","value","touched","month","day","year","onChange","bind","handleFormChange","handleFlatpickrChange","validation","dates","datestring","console","log","Date","field","currentYear","getFullYear","newState","formatter","formatYear","formatDayMonth","autofillYear","setState","isIncomplete","dateString","id","flatpickrDate","undefined","flatpickrOptions","dateFormat","wrap","allowInput","enableTime","maxDate","minDate","event","target","Component","propTypes","PropTypes","string","isRequired","func"],"mappings":"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","file":"index.js","sourcesContent":["import PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport Flatpickr from 'react-flatpickr';\nimport { set, cloneDeep } from 'lodash';\nimport { isAfter, isBefore, startOfDay } from 'date-fns';\n\nimport {formatYear, formatDayMonth, parseISODate, formatISOPartialDate, setValidDate, autofillYearPast, autofillYearFuture} from './dateHelpers';\n\n/**\n  Returns datestring in the form '2011-11-22'\n  Uses parts of us-form-system's DateWidget. Includes a Calendar date picker.\n  ref: https://github.com/cityofaustin/us-forms-system/blob/master/src/js/widgets/DateWidget.jsx\n\n  @param options.validation:\n    \"pastOnly\": only allow dates set in the past\n    \"futureOnly\": only allow dates set in the future\n**/\nconst CalendarDateWidget = (options) => {\n  return class CalendarDateWidget extends Component {\n\n    constructor(props) {\n      super(props);\n\n      this.state = {\n        value: parseISODate(this.props.value),\n        touched: {\n          month: false,\n          day: false,\n          year: false,\n        },\n      };\n      this.onChange = this.onChange.bind(this);\n      this.handleFormChange = this.handleFormChange.bind(this);\n      this.handleFlatpickrChange = this.handleFlatpickrChange.bind(this);\n\n      this.validation = options.validation;\n    }\n\n    onChange({ dates, datestring }) {\n      this.props.onChange(datestring);\n    }\n\n    isIncomplete({ month, day, year }) {\n      console.log(\"~~ isIncomplete???\")\n      if (!month || !day || !year) {\n        console.log(\"~~ Missing values!!\")\n        return true\n      } else if (\n        (this.validation === 'pastOnly') &&\n        (isAfter(new Date(year, month - 1, day), startOfDay(new Date())))\n      ) {\n        console.log(\"Safely in the past.\")\n        return true\n      } else if (\n        (this.validation === 'futureOnly') &&\n        (isBefore(new Date(year, month - 1, day), startOfDay(new Date())))\n      ) {\n        console.log(`isBefore1: ${new Date(year, month - 1, day)}`)\n        console.log(`isBefore2: ${new Date()}`)\n        console.log(`isBefore?: ${isBefore(new Date(year, month - 1, day), new Date())}`)\n        return true\n      } else {\n        return false\n      }\n    }\n\n    handleFormChange(field, value) {\n      const currentYear = (new Date()).getFullYear();\n\n      if (field === 'month') {\n        if ((value > 12)) {\n          return\n        }\n        if (value < 1) {\n          value = '';\n        }\n      }\n      if (field === 'day') {\n        if (value > 31) {\n          return\n        }\n        if (value < 1) {\n          value = '';\n        }\n      }\n      if (field === 'year') {\n        if ((this.validation == \"pastOnly\") && (value > currentYear)) {\n          value = currentYear;\n        } else if ((this.validation == \"futureOnly\") && (value < currentYear)) {\n          // value = currentYear;\n        }\n        if (value < 1) {\n          value = '';\n        }\n      }\n\n      let newState = cloneDeep(this.state);\n      const formatter = (field === 'year') ? formatYear : formatDayMonth;\n\n      set(newState, ['value', field], formatter(value));\n      set(newState, ['touched', field], true);\n\n      // Autofill year after filling month and day\n      if (\n        (\n          ((field === 'day') && (!!this.state.value.month)) ||\n          ((field === 'month') && (!!this.state.value.day))\n        ) && (!this.state.value.year)\n      ) {\n        let autofillYear = currentYear;\n        if (this.validation == \"pastOnly\") {\n          autofillYear = autofillYearPast(newState)\n        } else if (this.validation == \"futureOnly\") {\n          autofillYear = autofillYearFuture(newState)\n        }\n        set(newState, ['value', 'year'], autofillYear);\n      }\n\n      // If all 3 values are filled out, make sure they are a valid day\n      if (\n        !!newState.value.year &&\n        !!newState.value.day &&\n        !!newState.value.month\n      ) {\n        newState = setValidDate(newState, this.validation);\n      }\n\n      this.setState(newState, () => {\n        if (this.isIncomplete(newState.value)) {\n          this.props.onChange();\n        } else {\n          this.props.onChange(formatISOPartialDate(newState.value));\n        }\n      });\n    }\n\n    handleFlatpickrChange(dateString) {\n      let newState = cloneDeep(this.state);\n      set(newState, 'value', parseISODate(dateString));\n      set(newState, 'touched', {month: true, day: true, year: true});\n\n      this.setState(newState, () => {\n        if (this.isIncomplete(newState.value)) {\n          this.props.onChange();\n        } else {\n          this.props.onChange(formatISOPartialDate(newState.value));\n        }\n      })\n    }\n\n    render() {\n      const {id} = this.props;\n      const {month, day, year} = this.state.value;\n      const flatpickrDate = (month && day && year) ?\n        formatISOPartialDate({month,day,year}) : undefined;\n\n      const flatpickrOptions = {\n        dateFormat: 'Y-m-d',\n        wrap: true,\n        allowInput: false,\n        enableTime: false,\n      }\n      if (this.validation == \"pastOnly\") {\n        flatpickrOptions.maxDate = 'today';\n      } else if (this.validation == \"futureOnly\") {\n        flatpickrOptions.minDate = 'today';\n      }\n\n      return (\n        <div className=\"date-widget-container\">\n\n          <div className=\"date-widget-values-container\">\n            <fieldset className=\"date-fieldset\" id={id}>\n              <div className=\"usa-date-of-birth\">\n                <div className=\"usa-datefield usa-form-group usa-form-group-month\">\n                  <label className=\"input-date-label smaller-input\" htmlFor={`${id}_Month`}>Month</label>\n                  <input\n                    className=\"usa-input-inline\" id={`${id}_Month`} name={`${id}_Month`}\n                    type=\"number\" min=\"1\" max=\"12\" value={month}\n                    onChange={(event) => this.handleFormChange('month', event.target.value)}\n                  />\n                </div>\n                <div className=\"usa-datefield usa-form-group usa-form-group-day\">\n                  <label className=\"input-date-label smaller-input\" htmlFor={`${id}_Day`}>Day</label>\n                  <input\n                    className=\"usa-input-inline\" id={`${id}_Day`} name={`${id}_Day`}\n                    type=\"number\" min=\"1\" max=\"31\" value={day}\n                    onChange={(event) => this.handleFormChange('day', event.target.value)}\n                  />\n                </div>\n                <div className=\"usa-datefield usa-form-group usa-form-group-year usa-form-group-year-fix\">\n                  <label className=\"input-date-label smaller-input\" htmlFor={`${id}_Year`}>Year</label>\n                  <input\n                    className=\"usa-input-inline\" id={`${id}_Year`} name={`${id}_Year`}\n                    type=\"number\" min=\"1900\" value={year}\n                    onChange={(event) => this.handleFormChange('year', event.target.value)}\n                  />\n                </div>\n                <div aria-hidden className=\"usa-datefield usa-form-group flatpickr-container\">\n                  <Flatpickr\n                    options={flatpickrOptions}\n                    value={flatpickrDate}\n                    onChange={(dates, datestring) => this.handleFlatpickrChange(datestring)}\n                  >\n                    <label className=\"hidden-content\" htmlFor={`${id}_calendar`}>Calendar</label>\n                    <input className=\"hidden-flatpickr-input-box\" tabIndex=\"-1\" type=\"text\" data-input name={`${id}_calendar`} id={`${id}_calendar`}/>\n                    <span className=\"usa-input-inline flatpickr-input-button-container\" title=\"toggle\" data-toggle>\n                      <i className=\"material-icons flatpickr-input-button\">event</i>\n                    </span>\n                  </Flatpickr>\n                </div>\n              </div>\n            </fieldset>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  CalendarDateWidget.propTypes = {\n    id: PropTypes.string.isRequired,\n    onChange: PropTypes.func.isRequired,\n    value: PropTypes.string\n  };\n}\n\nexport default CalendarDateWidget;\n"]}